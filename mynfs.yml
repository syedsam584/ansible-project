---
- name: Setting up NFS server
  hosts: localhost
  gather_facts: false
  become: true
  vars_prompt: 
     
     - name: diskname
       prompt: "what is your diskname ?"
       private: no
     
     - name: dir_path
       prompt: "what is your dir_path name ?"
       private: no

  tasks:
  - name: first installing packages
    dnf: 
     name: nfs-utils 
     state: present
    ignore_errors: true

  - name: Creating new file system for NFS mount. 
    filesystem: 
       dev: "{{diskname}}"
       fstype: ext4
       force: yes

  - name: Create Directory
    file: 
       path: "{{dir_path}}"
       state: directory
       mode: "0777"

  - name: mount partition
    mount:
       path: "{{dir_path}}"
       src: "{{diskname}}"
       fstype: ext4
       state: mounted 

  - name: Create entry at /etc/fstab for file system.
    command: |
        echo "{{diskname}} {{dir_path}} xfs defaults 0 0" >> /etc/fstab

  - name: Configure exports
    lineinfile:
        path: /etc/exports
        line: "{{dir_path}} 192.168.48.0/24(rw,sync)"
   
  - name: nfs service restart
    service: 
         name: nfs-server.service
         state: restarted
         enabled: yes
         

  - name: Allow nfs through firewall
    firewalld:
        service: nfs
        permanent: yes
        state: enabled
        immediate: yes      


    

